<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spreadsheet Editor Mobile</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@11.1.0/dist/handsontable.min.css">
<style>
  body { font-family: Arial; margin:0; padding:0; }
  #hot { width: 100%; height: 400px; margin-bottom: 10px; }
  #keypad { display: flex; flex-wrap: wrap; justify-content: center; gap:5px; padding:5px; }
  #keypad button { flex:1 1 30%; padding:15px; font-size:18px; border-radius:5px; border:1px solid #333; background:#f0f0f0; cursor:pointer; }
  #keypad button:active { background:#ccc; }
  #loginBtn { display:block; margin:10px auto; padding:10px 20px; font-size:18px; cursor:pointer; }
</style>
</head>
<body>

<button id="loginBtn">Login Google</button>
<div id="hot"></div>

<div id="keypad">
  <button>1</button><button>2</button><button>3</button>
  <button>4</button><button>5</button><button>6</button>
  <button>7</button><button>8</button><button>9</button>
  <button>0</button><button>C</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/handsontable@11.1.0/dist/handsontable.min.js"></script>
<script src="https://apis.google.com/js/api.js"></script>
<script>
const SHEET_ID = '1q7PNM5Gc9ptRj_do-ek6bTjZq-R3UPLzj1MMhkM-LYE';
const RANGE = 'Sheet1';
const CLIENT_ID = '691043249480-idkuit1b05tc0n8ipo50uveka0h8lk4p.apps.googleusercontent.com'; // dari Google Cloud

let hot;
let selectedCell = {row: null, col: null};

function initClient() {
  gapi.load('client:auth2', async () => {
    await gapi.client.init({
      clientId: CLIENT_ID,
      discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
      scope: "https://www.googleapis.com/auth/spreadsheets"
    });
    document.getElementById('loginBtn').onclick = () => {
      gapi.auth2.getAuthInstance().signIn().then(loadData);
    };
  });
}

// Load data dari Google Sheet
async function loadData() {
  const response = await gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: SHEET_ID,
    range: RANGE
  });

  const data = response.result.values || [[]];

  // Inisialisasi Handsontable
  const container = document.getElementById('hot');
  hot = new Handsontable(container, {
    data: data,
    rowHeaders: true,
    colHeaders: true,
    width: '100%',
    height: 400,
    licenseKey: 'non-commercial-and-evaluation',
    afterSelection: (r, c) => {
      selectedCell.row = r;
      selectedCell.col = c;
    }
  });
}

// Simpan perubahan ke Google Sheet
async function saveData() {
  if(!hot) return;
  const values = hot.getData();
  await gapi.client.sheets.spreadsheets.values.update({
    spreadsheetId: SHEET_ID,
    range: RANGE,
    valueInputOption: 'USER_ENTERED',
    resource: { values }
  });
}

// Keypad input
document.querySelectorAll('#keypad button').forEach(btn => {
  btn.addEventListener('click', () => {
    if(selectedCell.row === null || selectedCell.col === null) return;
    let current = hot.getDataAtCell(selectedCell.row, selectedCell.col) || '';
    if(btn.textContent === 'C'){
      hot.setDataAtCell(selectedCell.row, selectedCell.col, '');
    } else {
      hot.setDataAtCell(selectedCell.row, selectedCell.col, current + btn.textContent);
    }
    saveData();
  });
});

window.onload = initClient;
</script>
</body>
</html>
