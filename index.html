<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Kalkulator JR Wellman Jewellry</title>
  <style>
 body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0 0 130px 0; /* tambah padding bawah untuk ruang keypad */
  background: #f9f9f9;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}


    h2 {
      margin: 10px 0;
      font-size: 18px;
      text-align: center;
    }

    #sheetSelect {
      margin: 5px auto;
      padding: 6px;
      font-size: 14px;
      border-radius: 6px;
      width: 90%;
      max-width: 300px;
    }

    /* Tabel fullscreen tanpa scroll */
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed; /* biar kolom fix width */
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
      font-size: 13px;
      word-wrap: break-word;
      word-break: break-word;
    }
    thead {
      background: #007bff;
      color: white;
      position: sticky;
      top: 0;
      z-index: 50;
    }
    thead th {
      padding: 6px;
      font-size: 11px;
      text-transform: uppercase;
    }
    tbody td {
      padding: 6px;
      border-bottom: 1px solid #eee;
      text-align: center;
      cursor: pointer;
      font-size: 12px;
    }
    tbody tr:nth-child(even) {
      background: #f9f9f9;
    }
    tbody tr:hover td {
      background: #eaf4ff;
    }
    td.active {
      background: #ffe58f !important;
      font-weight: bold;
      border: 2px solid #f0ad4e;
    }
    select {
      padding: 5px;
      font-size: 12px;
      border-radius: 6px;
      width: 100%;
    }

/* Keypad fix di bawah layar */
#keypad {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100%;
  background: #f9f9f9;
  padding: 10px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  box-shadow: 0 -2px 5px rgba(0,0,0,0.15);
  border-radius: 12px 12px 0 0;
  z-index: 1000;
}

    #keypad button {
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background: #007bff;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }
    #keypad button:hover { opacity: 0.9; }
    #keypad button:active { transform: scale(0.95); }
    #keypad .wide { grid-column: span 3; background: #28a745; }
    #keypad .clear { background: #dc3545; }

    /* Responsive */
    @media (max-width: 600px) {
      h2 { font-size: 16px; }
      #sheetSelect { font-size: 13px; }
      thead th, tbody td { font-size: 11px; padding: 4px; }
      #keypad button { font-size: 14px; padding: 12px; }
    }
  </style>
</head>
<body>

<h2>Kalkulator JR Wellman Jewellry</h2>

<select id="sheetSelect" onchange="loadData(this.value)">
  <option value="harga">üìë Harga</option>
  <option value="berat">‚öñÔ∏è Berat</option>
</select>

<table id="sheetTable"></table>

<div id="keypad">
  <button onclick="enterNum(1)">1</button>
  <button onclick="enterNum(2)">2</button>
  <button onclick="enterNum(3)">3</button>
  <button onclick="enterNum(4)">4</button>
  <button onclick="enterNum(5)">5</button>
  <button onclick="enterNum(6)">6</button>
  <button onclick="enterNum(7)">7</button>
  <button onclick="enterNum(8)">8</button>
  <button onclick="enterNum(9)">9</button>
  <button onclick="enterNum('.')">.</button>
  <button onclick="enterNum(0)">0</button>
  <button class="clear" onclick="clearCell()">Clear</button>
  <button class="wide" onclick="saveCell()">üíæ Save</button>
</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzWuZ2qioohOKEoOixWMAgs-8wEmQZ5SL_mwyc7AFnDgIoAQPjx-HsQ_7Oo5p_nRcjBwA/exec";

let selectedCell = null;
let sheetData = [];
let dropdownOptions = [];
const hiddenCols = Array.from({length: 8}, (_, i) => i + 6);

async function loadData(sheet="harga") {
  try {
    let res = await fetch(`${WEB_APP_URL}?sheet=${sheet}`);
    let json = await res.json();
    sheetData = json.data;
    dropdownOptions = json.dropdownOptions;

    let table = document.getElementById("sheetTable");
    table.innerHTML = "";

    if (sheetData.length > 0) {
      let thead = document.createElement("thead");
      let headerRow = document.createElement("tr");
      sheetData[0].forEach((h, j) => {
        if (!hiddenCols.includes(j)) {
          let th = document.createElement("th");
          th.innerText = h;
          headerRow.appendChild(th);
        }
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      let tbody = document.createElement("tbody");
      for (let i = 1; i < sheetData.length; i++) {
        let tr = document.createElement("tr");
        sheetData[i].forEach((val, j) => {
          if (!hiddenCols.includes(j)) {
            let td = document.createElement("td");
            if (j === 1 && dropdownOptions?.length) {
              let select = document.createElement("select");
              dropdownOptions.forEach(opt => {
                let option = document.createElement("option");
                option.value = opt;
                option.text = opt;
                if (opt === val) option.selected = true;
                select.appendChild(option);
              });
              select.onchange = () => {
                selectCell(i+1, j+1, td);
                td.dataset.value = select.value;
              };
              td.appendChild(select);
            } else {
              td.innerText = val;
              td.onclick = () => selectCell(i+1, j+1, td);
            }
            tr.appendChild(td);
          }
        });
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
    }
  } catch(err) {
    alert("Gagal load data: " + err);
  }
}

function selectCell(row, col, td) {
  document.querySelectorAll("td").forEach(x => x.classList.remove("active"));
  td.classList.add("active");
  selectedCell = {row, col, td};
}

function enterNum(num) {
  if(selectedCell && !selectedCell.td.querySelector("select")){
    selectedCell.td.innerText += num;
  }
}

function clearCell() {
  if(selectedCell && !selectedCell.td.querySelector("select")){
    selectedCell.td.innerText = "";
  }
}

async function saveCell() {
  if(selectedCell){
    let value = selectedCell.td.querySelector("select") 
                  ? selectedCell.td.querySelector("select").value 
                  : selectedCell.td.innerText;
    try {
      await fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify({
          sheet: document.getElementById("sheetSelect").value,
          row: selectedCell.row,
          col: selectedCell.col,
          value: value
        })
      });
      alert("‚úÖ Data tersimpan ke Google Sheets!");
    } catch(err) {
      alert("‚ùå Gagal simpan: " + err);
    }
  } else {
    alert("Pilih cell dulu!");
  }
}

loadData("harga");
</script>
</body>
</html>
